<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Donnelly Adventures - California 2026</title>
  <meta name="description" content="The Donnelly Family California Adventure - January 23 - February 4, 2026">
  <meta name="theme-color" content="#0d2818">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
  <!-- Cloudinary Upload Widget -->
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --green-dark: #0d2818;
      --green-medium: #1a3d2a;
      --green-light: #adebb3;
      --gold: #efbf04;
      --white: #e0e0e0;
      --gray: #888;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--green-dark);
      color: var(--white);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated Background */
    .bg-stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(173,235,179,0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(239,191,4,0.06) 0%, transparent 50%),
        linear-gradient(135deg, #0d2818 0%, #1a3d2a 50%, #0d2818 100%);
    }

    .star {
      position: absolute;
      width: 3px;
      height: 3px;
      background: var(--gold);
      border-radius: 50%;
      animation: twinkle 3s ease-in-out infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.5); }
    }

    /* Hero Section */
    .hero {
      position: relative;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('https://images.unsplash.com/photo-1597466599360-3b9775841aec?w=1600&q=80') center/cover;
      opacity: 0.15;
      z-index: 0;
    }

    .hero-content {
      position: relative;
      z-index: 1;
    }

    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(239,191,4,0.9);
      color: var(--green-dark);
      padding: 12px 24px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 700;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s;
    }

    .back-btn:hover {
      background: var(--gold);
      transform: scale(1.05);
    }

    .hero-badge {
      display: inline-block;
      padding: 8px 20px;
      background: rgba(239,191,4,0.2);
      border: 2px solid var(--gold);
      border-radius: 50px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: var(--gold);
      margin-bottom: 20px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239,191,4,0.4); }
      50% { box-shadow: 0 0 0 15px rgba(239,191,4,0); }
    }

    .hero h1 {
      font-size: clamp(40px, 10vw, 80px);
      font-weight: 900;
      line-height: 1.1;
      background: linear-gradient(135deg, var(--green-light), var(--gold), var(--green-light));
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s ease-in-out infinite;
      text-shadow: 0 0 60px rgba(173,235,179,0.3);
    }

    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .hero .subtitle {
      font-size: clamp(16px, 4vw, 24px);
      color: var(--green-light);
      margin-top: 10px;
      font-weight: 500;
    }

    .hero .dates {
      font-size: clamp(20px, 5vw, 32px);
      color: var(--gold);
      font-weight: 700;
      margin-top: 15px;
      text-shadow: 0 0 30px rgba(239,191,4,0.5);
    }

    /* Countdown */
    .countdown {
      display: flex;
      justify-content: center;
      gap: clamp(15px, 5vw, 40px);
      margin-top: 40px;
      padding: 30px;
      background: rgba(0,0,0,0.4);
      border-radius: 20px;
      border: 2px solid rgba(239,191,4,0.3);
      backdrop-filter: blur(10px);
    }

    .countdown-item {
      text-align: center;
    }

    .countdown-number {
      font-size: clamp(40px, 12vw, 72px);
      font-weight: 900;
      color: var(--gold);
      text-shadow: 0 0 40px rgba(239,191,4,0.6);
      line-height: 1;
    }

    .countdown-label {
      font-size: clamp(10px, 3vw, 14px);
      color: var(--green-light);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 5px;
    }

    .scroll-indicator {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      animation: bounce 2s ease-in-out infinite;
      color: var(--gold);
      font-size: 30px;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(15px); }
    }

    /* Stats Bar */
    .stats-bar {
      display: flex;
      justify-content: space-around;
      background: linear-gradient(90deg, rgba(239,191,4,0.15), rgba(173,235,179,0.1), rgba(239,191,4,0.15));
      padding: 30px 20px;
      border-top: 2px solid var(--gold);
      border-bottom: 2px solid var(--gold);
      position: relative;
      z-index: 1;
    }

    .stat {
      text-align: center;
    }

    .stat-num {
      font-size: clamp(32px, 8vw, 56px);
      font-weight: 900;
      color: var(--gold);
      text-shadow: 0 0 20px rgba(239,191,4,0.4);
    }

    .stat-label {
      font-size: clamp(10px, 3vw, 14px);
      color: var(--green-light);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* Section Styles */
    section {
      position: relative;
      z-index: 1;
      padding: 60px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .section-title {
      font-size: clamp(24px, 6vw, 36px);
      color: var(--green-light);
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 15px;
      border-left: 5px solid var(--gold);
      padding-left: 20px;
      text-shadow: 0 0 20px rgba(173,235,179,0.3);
    }

    /* Destination Cards */
    .destination {
      background: rgba(173,235,179,0.05);
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 40px;
      border: 2px solid rgba(173,235,179,0.3);
      box-shadow: 0 10px 40px rgba(0,0,0,0.3), 0 0 60px rgba(173,235,179,0.05);
      transition: all 0.4s;
    }

    .destination:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 80px rgba(173,235,179,0.1);
      border-color: var(--gold);
    }

    .destination-header {
      padding: 25px 30px;
      background: linear-gradient(135deg, rgba(173,235,179,0.2), rgba(239,191,4,0.1));
      border-bottom: 2px solid rgba(239,191,4,0.3);
    }

    .destination-header h3 {
      font-size: clamp(20px, 5vw, 28px);
      color: var(--green-light);
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .badge {
      display: inline-block;
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-booked {
      background: rgba(173,235,179,0.3);
      color: var(--green-light);
      border: 1px solid var(--green-light);
      box-shadow: 0 0 15px rgba(173,235,179,0.3);
    }

    .badge-fire {
      background: rgba(239,191,4,0.3);
      color: var(--gold);
      border: 1px solid var(--gold);
      box-shadow: 0 0 15px rgba(239,191,4,0.3);
      animation: glow 2s ease-in-out infinite;
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 15px rgba(239,191,4,0.3); }
      50% { box-shadow: 0 0 25px rgba(239,191,4,0.6); }
    }

    .destination-dates {
      color: var(--gold);
      font-size: 15px;
      margin-top: 8px;
      font-weight: 500;
    }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 4px;
    }

    .photo-grid img {
      width: 100%;
      height: clamp(150px, 20vw, 280px);
      object-fit: cover;
      object-position: center;
      transition: all 0.4s;
      cursor: pointer;
    }

    .photo-grid img:hover {
      transform: scale(1.03);
      filter: brightness(1.1);
    }

    .destination-content {
      padding: 25px 30px;
    }

    .destination-content p {
      color: #aaa;
      font-size: 15px;
      line-height: 1.7;
    }

    .destination-content strong {
      color: var(--white);
    }

    .destination-content .highlight {
      color: var(--gold);
      font-weight: 600;
    }

    /* Visual Calendar */
    .visual-calendar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      padding: 30px;
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      border: 2px solid rgba(173,235,179,0.2);
    }

    .cal-day {
      width: clamp(55px, 12vw, 75px);
      padding: 12px 8px;
      border-radius: 16px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
    }

    .cal-day:hover {
      transform: scale(1.15) rotate(5deg);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .cal-day.today {
      animation: todayPulse 2s ease-in-out infinite;
    }

    @keyframes todayPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239,191,4,0.6); }
      50% { box-shadow: 0 0 0 10px rgba(239,191,4,0); }
    }

    .cal-icon { font-size: clamp(24px, 6vw, 36px); margin-bottom: 5px; }
    .cal-date { font-size: clamp(10px, 2.5vw, 12px); font-weight: 700; color: #fff; }
    .cal-label { font-size: clamp(8px, 2vw, 10px); color: rgba(255,255,255,0.7); text-transform: uppercase; }

    .cal-day.sacramento { background: linear-gradient(135deg, #4a2600, #3d1f00); border: 2px solid #e67e22; }
    .cal-day.hockey { background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #4a90a4; }
    .cal-day.disney { background: linear-gradient(135deg, #2d1f3d, #1a1a2e); border: 2px solid #9b59b6; }
    .cal-day.wolf { background: linear-gradient(135deg, #1e3a5f, #16213e); border: 2px solid #3498db; }
    .cal-day.redding { background: linear-gradient(135deg, #1d4a1d, #0d2818); border: 2px solid #27ae60; }
    .cal-day.home { background: linear-gradient(135deg, #3d2a00, #2d1f00); border: 2px solid var(--gold); }

    .cal-legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
      font-size: 13px;
      color: #aaa;
    }

    .cal-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 4px;
    }

    .sacramento-dot { background: #e67e22; }
    .hockey-dot { background: #4a90a4; }
    .disney-dot { background: #9b59b6; }
    .wolf-dot { background: #3498db; }
    .redding-dot { background: #27ae60; }

    /* Highlights */
    .highlights {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .highlight-item {
      background: rgba(173,235,179,0.08);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      border: 1px solid rgba(173,235,179,0.2);
      transition: all 0.3s;
    }

    .highlight-item:hover {
      background: rgba(239,191,4,0.15);
      border-color: var(--gold);
      transform: translateX(10px);
      box-shadow: 0 5px 20px rgba(239,191,4,0.2);
    }

    .highlight-item .emoji { font-size: 32px; }
    .highlight-item .text { color: var(--white); font-size: 15px; }

    /* Budget Section */
    .budget-section {
      background: linear-gradient(135deg, rgba(173,235,179,0.1), rgba(239,191,4,0.08));
      border-radius: 24px;
      padding: 40px;
      border: 2px solid rgba(239,191,4,0.4);
      box-shadow: 0 0 60px rgba(239,191,4,0.1);
    }

    .budget-total {
      font-size: clamp(40px, 10vw, 64px);
      color: var(--gold);
      font-weight: 900;
      text-align: center;
      margin-top: 30px;
      text-shadow: 0 0 40px rgba(239,191,4,0.5);
    }

    .budget-total small {
      font-size: clamp(14px, 4vw, 20px);
      color: var(--green-light);
      display: block;
      margin-top: 10px;
    }

    /* Progress Bar */
    .progress-bar {
      background: rgba(0,0,0,0.4);
      border-radius: 15px;
      height: 30px;
      margin: 30px 0;
      overflow: hidden;
      border: 2px solid rgba(173,235,179,0.3);
    }

    .progress-fill {
      background: linear-gradient(90deg, var(--green-light), var(--gold), var(--green-light));
      background-size: 200% 100%;
      height: 100%;
      border-radius: 12px;
      animation: progressShimmer 2s linear infinite;
      box-shadow: 0 0 20px rgba(173,235,179,0.5);
    }

    @keyframes progressShimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .progress-label {
      text-align: center;
      color: var(--gold);
      font-size: 16px;
      font-weight: 600;
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid rgba(173,235,179,0.3);
    }

    th {
      background: linear-gradient(90deg, var(--green-light), #7dd98a);
      color: var(--green-dark);
      padding: 16px 20px;
      text-align: left;
      font-weight: 700;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    td {
      padding: 14px 20px;
      border-bottom: 1px solid rgba(173,235,179,0.15);
      color: var(--white);
      font-size: 14px;
    }

    tr:nth-child(even) td { background: rgba(173,235,179,0.05); }
    tr:hover td { background: rgba(173,235,179,0.1); }

    .booked { color: var(--green-light); font-weight: 700; }

    /* Interactive Features */
    .floating-actions {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 1000;
    }

    .fab {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 5px 25px rgba(0,0,0,0.4);
      transition: all 0.3s;
    }

    .fab:hover {
      transform: scale(1.15);
    }

    .fab-photo {
      background: linear-gradient(135deg, var(--gold), #f5d000);
      color: var(--green-dark);
    }

    .fab-journal {
      background: linear-gradient(135deg, var(--green-light), #7dd98a);
      color: var(--green-dark);
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
    }

    .modal.active { display: flex; }

    .modal-content {
      background: linear-gradient(135deg, var(--green-dark), var(--green-medium));
      border: 2px solid var(--green-light);
      border-radius: 24px;
      padding: 30px;
      width: 100%;
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 100px rgba(173,235,179,0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .modal-header h2 {
      color: var(--green-light);
      font-size: 24px;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 32px;
      cursor: pointer;
      transition: color 0.3s;
    }

    .modal-close:hover { color: var(--gold); }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: var(--green-light);
      font-size: 13px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 14px;
      background: rgba(0,0,0,0.3);
      border: 2px solid rgba(173,235,179,0.3);
      border-radius: 12px;
      color: var(--white);
      font-family: inherit;
      font-size: 15px;
      transition: border-color 0.3s;
    }

    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: var(--gold);
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }

    .file-input-wrapper {
      position: relative;
      background: rgba(239,191,4,0.1);
      border: 3px dashed var(--gold);
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .file-input-wrapper:hover {
      background: rgba(239,191,4,0.2);
      border-style: solid;
    }

    .file-input-wrapper input {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    .file-input-wrapper .icon { font-size: 48px; }
    .file-input-wrapper p { color: var(--gold); margin-top: 15px; font-weight: 600; }

    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--gold), #f5d000);
      border: none;
      border-radius: 12px;
      color: var(--green-dark);
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn:hover { transform: scale(1.02); box-shadow: 0 10px 30px rgba(239,191,4,0.4); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* Journal Display */
    .journal-entries {
      margin-top: 30px;
    }

    .journal-entry {
      background: rgba(173,235,179,0.08);
      border: 1px solid rgba(173,235,179,0.2);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .journal-entry:hover {
      border-color: var(--gold);
      transform: translateX(5px);
    }

    .journal-entry .author {
      color: var(--gold);
      font-weight: 700;
      font-size: 16px;
    }

    .journal-entry .date {
      color: var(--gray);
      font-size: 12px;
      margin-left: 10px;
    }

    .journal-entry .content {
      color: var(--white);
      font-size: 15px;
      margin-top: 10px;
      line-height: 1.6;
    }

    /* Gallery Section */
    .gallery-section {
      margin-top: 30px;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
    }

    .gallery-item {
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      background: rgba(0,0,0,0.3);
    }

    .gallery-item:hover {
      transform: scale(1.02);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .gallery-item .photo-wrapper {
      aspect-ratio: 1;
      cursor: pointer;
      overflow: hidden;
    }

    .gallery-item img, .gallery-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center center;
    }

    .gallery-item .photo-info {
      padding: 10px 12px;
      background: rgba(0,0,0,0.5);
    }

    .gallery-item .photo-caption {
      color: var(--white);
      font-size: 13px;
      line-height: 1.4;
      margin-bottom: 6px;
    }

    .gallery-item .photo-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--gray);
    }

    .gallery-item .photo-author {
      color: var(--gold);
      font-weight: 600;
    }

    .gallery-item .delete-btn {
      background: rgba(255,68,68,0.8);
      border: none;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .gallery-item .delete-btn:hover {
      background: #ff4444;
      transform: scale(1.1);
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }

    .lightbox.active { display: flex; }

    .lightbox img, .lightbox video {
      max-width: 95%;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 8px;
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 30px;
      background: none;
      border: none;
      color: white;
      font-size: 40px;
      cursor: pointer;
    }

    .lightbox-caption {
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      text-align: center;
      color: white;
      font-size: 16px;
      padding: 0 20px;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--green-light);
      color: var(--green-dark);
      padding: 15px 30px;
      border-radius: 30px;
      font-weight: 700;
      font-size: 15px;
      z-index: 4000;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .toast.show { opacity: 1; }

    /* Footer */
    .footer {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(0deg, rgba(173,235,179,0.1), transparent);
      border-top: 3px solid rgba(239,191,4,0.5);
      position: relative;
      z-index: 1;
    }

    .footer .love {
      font-size: 60px;
      margin-bottom: 20px;
      animation: heartbeat 1.5s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    .footer .trip-message {
      font-size: clamp(18px, 5vw, 28px);
      color: var(--gold);
      font-weight: 700;
      margin-bottom: 15px;
      text-shadow: 0 0 30px rgba(239,191,4,0.5);
    }

    .footer .sub-message {
      font-size: clamp(14px, 4vw, 20px);
      color: var(--green-light);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--gray);
    }

    .empty-state .icon { font-size: 64px; margin-bottom: 20px; }
    .empty-state p { font-size: 16px; }

    /* Caption Items in batch modal */
    .caption-item {
      display: flex;
      gap: 15px;
      align-items: flex-start;
      padding: 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(173,235,179,0.2);
    }

    .caption-item img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      flex-shrink: 0;
    }

    .caption-item .caption-input-wrapper {
      flex: 1;
    }

    .caption-item input {
      width: 100%;
      padding: 12px;
      background: rgba(0,0,0,0.4);
      border: 2px solid rgba(173,235,179,0.3);
      border-radius: 8px;
      color: var(--white);
      font-family: inherit;
      font-size: 14px;
    }

    .caption-item input:focus {
      outline: none;
      border-color: var(--gold);
    }

    /* Edit button on gallery items */
    .gallery-item .photo-actions {
      display: flex;
      gap: 6px;
    }

    .gallery-item .edit-btn {
      background: rgba(239,191,4,0.8);
      border: none;
      color: var(--green-dark);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
    }

    .gallery-item .edit-btn:hover {
      background: var(--gold);
      transform: scale(1.1);
    }

    /* Tab Navigation */
    .tab-nav {
      position: sticky;
      top: 0;
      z-index: 500;
      background: rgba(13,40,24,0.95);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid rgba(239,191,4,0.3);
      padding: 0;
      display: flex;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .tab-nav::-webkit-scrollbar { display: none; }

    .tab-link {
      flex-shrink: 0;
      padding: 14px 20px;
      color: var(--gray);
      text-decoration: none;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .tab-link:hover, .tab-link.active {
      color: var(--gold);
      border-bottom-color: var(--gold);
    }

    /* Section photo galleries */
    .section-gallery {
      margin-top: 20px;
      padding: 20px 30px 25px;
      border-top: 1px solid rgba(173,235,179,0.15);
    }

    .section-gallery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .section-gallery-header h4 {
      color: var(--gold);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .section-gallery-header .photo-count {
      color: var(--gray);
      font-size: 12px;
    }

    .section-gallery .gallery-grid {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }

    .section-gallery .empty-state {
      padding: 30px 20px;
    }

    .section-gallery .empty-state .icon { font-size: 36px; margin-bottom: 10px; }
    .section-gallery .empty-state p { font-size: 13px; }

    /* Lightbox navigation */
    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(239,191,4,0.8);
      color: var(--green-dark);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
    }

    .lightbox-nav:hover {
      background: var(--gold);
      transform: translateY(-50%) scale(1.1);
    }

    .lightbox-prev { left: 20px; }
    .lightbox-next { right: 20px; }

    .lightbox-counter {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--gold);
      font-size: 14px;
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .photo-grid { grid-template-columns: 1fr; }
      .photo-grid img { height: 200px; }
      .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
      .gallery-item { aspect-ratio: 3/4; }
      .floating-actions { bottom: 20px; right: 20px; }
      .fab { width: 50px; height: 50px; font-size: 20px; }
      .tab-link { padding: 12px 15px; font-size: 11px; }
      .lightbox-nav { width: 40px; height: 40px; font-size: 18px; }
      .lightbox-prev { left: 10px; }
      .lightbox-next { right: 10px; }
      .trip-progress-bar { flex-direction: column; gap: 15px; padding: 20px; }
      .weather-widget { flex-direction: column; text-align: center; }
    }

    /* ========== NEW FEATURES ========== */

    /* Trip Progress Bar */
    .trip-progress-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, rgba(239,191,4,0.2), rgba(173,235,179,0.1));
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: 20px 30px;
      margin: 20px auto;
      max-width: 800px;
      gap: 20px;
      box-shadow: 0 10px 40px rgba(239,191,4,0.2);
    }

    .trip-progress-info {
      text-align: center;
    }

    .trip-day-number {
      font-size: 48px;
      font-weight: 900;
      color: var(--gold);
      line-height: 1;
      text-shadow: 0 0 30px rgba(239,191,4,0.5);
    }

    .trip-day-label {
      font-size: 14px;
      color: var(--green-light);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .trip-progress-visual {
      flex: 1;
      max-width: 400px;
    }

    .trip-progress-track {
      background: rgba(0,0,0,0.4);
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      border: 2px solid rgba(173,235,179,0.3);
    }

    .trip-progress-fill {
      background: linear-gradient(90deg, var(--green-light), var(--gold));
      height: 100%;
      border-radius: 8px;
      transition: width 1s ease;
      box-shadow: 0 0 20px rgba(239,191,4,0.5);
    }

    .trip-progress-text {
      text-align: center;
      margin-top: 8px;
      font-size: 13px;
      color: var(--gray);
    }

    .trip-location {
      text-align: center;
    }

    .trip-location-icon {
      font-size: 36px;
      margin-bottom: 5px;
    }

    .trip-location-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--green-light);
    }

    /* Weather Widget */
    .weather-widget {
      display: flex;
      align-items: center;
      gap: 20px;
      background: linear-gradient(135deg, rgba(173,235,179,0.15), rgba(0,0,0,0.3));
      border: 1px solid rgba(173,235,179,0.3);
      border-radius: 16px;
      padding: 15px 25px;
      margin: 20px auto;
      max-width: 500px;
    }

    .weather-icon {
      font-size: 48px;
    }

    .weather-info {
      flex: 1;
    }

    .weather-temp {
      font-size: 32px;
      font-weight: 900;
      color: var(--gold);
    }

    .weather-desc {
      font-size: 14px;
      color: var(--green-light);
    }

    .weather-location {
      font-size: 12px;
      color: var(--gray);
      margin-top: 4px;
    }

    /* Currently At Indicator */
    .destination.currently-here {
      border-color: var(--gold) !important;
      box-shadow: 0 0 40px rgba(239,191,4,0.3), 0 20px 60px rgba(0,0,0,0.4) !important;
    }

    .destination.currently-here .destination-header {
      background: linear-gradient(135deg, rgba(239,191,4,0.3), rgba(173,235,179,0.2)) !important;
    }

    .currently-here-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      padding: 8px 16px;
      border-radius: 50px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      animation: liveGlow 2s ease-in-out infinite;
      margin-left: 10px;
    }

    .currently-here-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: liveDot 1s ease-in-out infinite;
    }

    @keyframes liveGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(239,68,68,0.5); }
      50% { box-shadow: 0 0 25px rgba(239,68,68,0.8); }
    }

    @keyframes liveDot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Entrance Animations */
    .animate-on-scroll {
      opacity: 0;
      transform: translateY(40px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .animate-on-scroll.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .animate-on-scroll.delay-1 { transition-delay: 0.1s; }
    .animate-on-scroll.delay-2 { transition-delay: 0.2s; }
    .animate-on-scroll.delay-3 { transition-delay: 0.3s; }

    /* Emoji Reactions */
    .reactions-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 0;
      flex-wrap: wrap;
    }

    .reaction-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .reaction-btn:hover {
      background: rgba(239,191,4,0.3);
      border-color: var(--gold);
      transform: scale(1.1);
    }

    .reaction-btn.active {
      background: rgba(239,191,4,0.4);
      border-color: var(--gold);
    }

    .reaction-btn .count {
      font-size: 12px;
      color: var(--white);
      font-weight: 600;
    }

    .add-reaction-btn {
      background: transparent;
      border: 2px dashed rgba(255,255,255,0.3);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      color: var(--gray);
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-reaction-btn:hover {
      border-color: var(--gold);
      color: var(--gold);
    }

    .reaction-picker {
      position: absolute;
      background: var(--green-dark);
      border: 2px solid var(--gold);
      border-radius: 12px;
      padding: 10px;
      display: none;
      gap: 8px;
      z-index: 100;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .reaction-picker.show {
      display: flex;
    }

    .reaction-picker button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .reaction-picker button:hover {
      background: rgba(239,191,4,0.3);
      transform: scale(1.2);
    }

    /* Offline indicator */
    .offline-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, #ef4444, #dc2626);
      color: white;
      text-align: center;
      padding: 10px;
      font-size: 14px;
      font-weight: 600;
      z-index: 9999;
      display: none;
    }

    .offline-banner.show {
      display: block;
    }

    /* Memory Counter */
    .memory-counter {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: linear-gradient(135deg, rgba(173,235,179,0.15), rgba(239,191,4,0.1));
      border: 2px solid rgba(173,235,179,0.4);
      border-radius: 16px;
      padding: 20px 30px;
      margin: 20px auto;
      max-width: 400px;
      animation: memoryGlow 3s ease-in-out infinite;
    }

    @keyframes memoryGlow {
      0%, 100% { box-shadow: 0 5px 30px rgba(173,235,179,0.2); }
      50% { box-shadow: 0 5px 40px rgba(173,235,179,0.4); }
    }

    .memory-counter-icon {
      font-size: 48px;
      animation: cameraBounce 2s ease-in-out infinite;
    }

    @keyframes cameraBounce {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      75% { transform: scale(1.1) rotate(5deg); }
    }

    .memory-counter-stats {
      text-align: left;
    }

    .memory-count {
      font-size: 24px;
      font-weight: 900;
      color: var(--green-light);
    }

    .memory-count span {
      color: var(--gold);
      font-size: 32px;
    }

    .memory-subtitle {
      font-size: 13px;
      color: var(--gray);
      margin-top: 4px;
    }

    /* Photo of the Day */
    .photo-of-day {
      background: linear-gradient(135deg, rgba(239,191,4,0.15), rgba(173,235,179,0.08));
      border: 3px solid var(--gold);
      border-radius: 24px;
      padding: 25px;
      margin: 25px auto;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 15px 50px rgba(239,191,4,0.2);
      display: none;
    }

    .photo-of-day.show {
      display: block;
      animation: fadeInUp 0.6s ease;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .photo-of-day-label {
      font-size: 14px;
      color: var(--gold);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
    }

    .photo-of-day-image-wrapper {
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      margin-bottom: 15px;
    }

    .photo-of-day-image-wrapper img {
      width: 100%;
      max-height: 350px;
      object-fit: cover;
      display: block;
      transition: transform 0.5s ease;
    }

    .photo-of-day-image-wrapper:hover img {
      transform: scale(1.03);
    }

    .photo-of-day-caption {
      font-size: 18px;
      color: var(--white);
      font-weight: 600;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .photo-of-day-meta {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-size: 13px;
      color: var(--gray);
    }

    .potd-author {
      color: var(--gold);
    }

    /* Today's Calendar Highlight */
    .cal-day.today {
      position: relative;
      animation: todayPulse 2s ease-in-out infinite;
      transform: scale(1.1);
      z-index: 10;
    }

    .cal-day.today::after {
      content: 'TODAY!';
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gold);
      color: var(--green-dark);
      font-size: 9px;
      font-weight: 900;
      padding: 3px 8px;
      border-radius: 10px;
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      .memory-counter { flex-direction: column; text-align: center; padding: 15px 20px; }
      .memory-counter-stats { text-align: center; }
      .photo-of-day { margin: 20px 15px; padding: 20px; }
      .photo-of-day-image-wrapper img { max-height: 280px; }
    }
  </style>
</head>
<body>
  <a href="/" class="back-btn">‚Üê Back to Adventures</a>

  <!-- Animated Background -->
  <div class="bg-stars" id="stars"></div>

  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-content">
      <div class="hero-badge">The Ultimate Family Road Trip</div>
      <h1>California<br>Adventure 2026</h1>
      <div class="subtitle">The Donnelly Family</div>
      <div class="dates">January 22 - February 4</div>

      <div class="countdown">
        <div class="countdown-item">
          <div class="countdown-number" id="days">--</div>
          <div class="countdown-label">Days</div>
        </div>
        <div class="countdown-item">
          <div class="countdown-number" id="hours">--</div>
          <div class="countdown-label">Hours</div>
        </div>
        <div class="countdown-item">
          <div class="countdown-number" id="minutes">--</div>
          <div class="countdown-label">Minutes</div>
        </div>
        <div class="countdown-item">
          <div class="countdown-number" id="seconds">--</div>
          <div class="countdown-label">Seconds</div>
        </div>
      </div>
    </div>
    <div class="scroll-indicator">‚Üì</div>
  </div>

  <!-- Stats Bar -->
  <div class="stats-bar">
    <div class="stat">
      <div class="stat-num">14</div>
      <div class="stat-label">Days</div>
    </div>
    <div class="stat">
      <div class="stat-num">13</div>
      <div class="stat-label">Nights</div>
    </div>
    <div class="stat">
      <div class="stat-num">6</div>
      <div class="stat-label">Destinations</div>
    </div>
    <div class="stat">
      <div class="stat-num">2,050</div>
      <div class="stat-label">Miles</div>
    </div>
  </div>

  <!-- Offline Banner -->
  <div class="offline-banner" id="offline-banner">
    üì¥ You're offline - but don't worry, everything still works!
  </div>

  <!-- Trip Progress Bar -->
  <div class="trip-progress-bar" id="trip-progress">
    <div class="trip-progress-info">
      <div class="trip-day-number" id="current-day">--</div>
      <div class="trip-day-label">Day of Trip</div>
    </div>
    <div class="trip-progress-visual">
      <div class="trip-progress-track">
        <div class="trip-progress-fill" id="progress-fill" style="width: 0%"></div>
      </div>
      <div class="trip-progress-text" id="progress-text">Trip hasn't started yet!</div>
    </div>
    <div class="trip-location">
      <div class="trip-location-icon" id="location-icon">üè†</div>
      <div class="trip-location-name" id="location-name">Home</div>
    </div>
  </div>

  <!-- Weather Widget -->
  <div class="weather-widget" id="weather-widget">
    <div class="weather-icon" id="weather-icon">üå§Ô∏è</div>
    <div class="weather-info">
      <div class="weather-temp" id="weather-temp">--¬∞F</div>
      <div class="weather-desc" id="weather-desc">Loading weather...</div>
      <div class="weather-location" id="weather-location">Current destination</div>
    </div>
  </div>

  <!-- Memory Counter -->
  <div class="memory-counter" id="memory-counter">
    <div class="memory-counter-icon">üì∏</div>
    <div class="memory-counter-stats">
      <div class="memory-count"><span id="photo-count">--</span> Memories Captured</div>
      <div class="memory-subtitle" id="memory-subtitle">Loading...</div>
    </div>
  </div>

  <!-- Photo of the Day -->
  <div class="photo-of-day" id="photo-of-day">
    <div class="photo-of-day-label">‚ú® Featured Memory ‚ú®</div>
    <div class="photo-of-day-image-wrapper">
      <img id="potd-image" src="" alt="Photo of the day" loading="lazy">
    </div>
    <div class="photo-of-day-caption" id="potd-caption"></div>
    <div class="photo-of-day-meta">
      <span class="potd-author">üì∑ <span id="potd-author"></span></span>
      <span class="potd-day" id="potd-day"></span>
    </div>
  </div>

  <!-- Tab Navigation -->
  <nav class="tab-nav" id="tab-nav">
    <a href="#route" class="tab-link">Route</a>
    <a href="#sacramento" class="tab-link">Sacramento</a>
    <a href="#sanjose" class="tab-link">San Jose</a>
    <a href="#disney" class="tab-link">Disney</a>
    <a href="#greatwolf" class="tab-link">Great Wolf</a>
    <a href="#redding" class="tab-link">Redding</a>
    <a href="#calendar" class="tab-link">Calendar</a>
    <a href="#highlights" class="tab-link">Highlights</a>
    <a href="#journal" class="tab-link">Journal</a>
  </nav>

  <!-- Route Overview -->
  <section id="route" style="padding-top: 40px; padding-bottom: 20px;">
    <div style="background: rgba(239,191,4,0.1); border: 2px solid rgba(239,191,4,0.3); border-radius: 16px; padding: 25px; text-align: center;">
      <h3 style="color: var(--gold); margin-bottom: 15px; font-size: 18px;">üöó The Route from Sherwood, OR</h3>
      <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; font-size: 14px;">
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">Sherwood ‚Üí Sacramento <strong style="color: var(--gold);">530 mi</strong></span>
        <span style="color: var(--gold);">‚Üí</span>
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">Jelly Belly <strong style="color: var(--gold);">55 mi</strong></span>
        <span style="color: var(--gold);">‚Üí</span>
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">San Jose <strong style="color: var(--gold);">60 mi</strong></span>
        <span style="color: var(--gold);">‚Üí</span>
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">Anaheim <strong style="color: var(--gold);">366 mi</strong></span>
        <span style="color: var(--gold);">‚Üí</span>
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">Great Wolf <strong style="color: var(--gold);">3 mi</strong></span>
        <span style="color: var(--gold);">‚Üí</span>
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">Redding <strong style="color: var(--gold);">573 mi</strong></span>
        <span style="color: var(--gold);">‚Üí</span>
        <span style="background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; color: var(--white);">Home! <strong style="color: var(--gold);">410 mi</strong></span>
      </div>
    </div>
  </section>

  <!-- Where We're Staying -->
  <section>
    <h2 class="section-title">üè® Where We're Staying</h2>

    <!-- Sacramento -->
    <div class="destination" id="sacramento">
      <div class="destination-header">
        <h3>ü¶Å Sacramento - Lion King Night </h3>
        <div class="destination-dates">Thursday, Jan 22 ‚Ä¢ 1 Night ‚Ä¢ 530 miles from Sherwood</div>
      </div>
      <div class="photo-grid">
        <img src="https://cdn.mytheatreland.com/images/show/03102_show_1279x840_03.jpg" alt="The Lion King Musical" loading="lazy">
        <img src="https://cdn-tp1.mozu.com/9046-m1/cms/files/3cf7d9f5-917c-4866-bd95-38f06ce67586?max=1920" alt="Jelly Belly Factory" loading="lazy">
      </div>
      <div class="destination-content">
        <p><span class="highlight">The Lion King @ SAFE Credit Union Performing Arts Center</span> - 7:30 PM<br>
        Orchestra Section DD-EE, Row FF, Seats 1-15 üé≠<br>
        <span class="highlight">Hotel:</span> Hyatt Regency Sacramento, 1209 L Street (check-in 4pm)<br>
        <span class="highlight">Friday Morning:</span> üç¨ <strong>Jelly Belly Factory Tour</strong> in Fairfield on the way to San Jose!</p>
      </div>
      <div class="section-gallery" data-section="sacramento">
        <div class="section-gallery-header">
          <h4>Photos</h4>
          <span class="photo-count"></span>
        </div>
        <div class="gallery-grid" id="gallery-sacramento"></div>
      </div>
    </div>

    <!-- San Jose -->
    <div class="destination" id="sanjose">
      <div class="destination-header">
        <h3>ü¶à San Jose - Sharks Game Night </h3>
        <div class="destination-dates">Friday, Jan 23 ‚Ä¢ 1 Night ‚Ä¢ 115 miles from Sacramento (via Jelly Belly)</div>
      </div>
      <div class="photo-grid">
        <img src="https://media.d3.nhle.com/image/private/t_ratio16_9-size40/dpr_2.0/f_png/v1732025093/prd/l8y3g90ap8awanthfuw3.png" alt="San Jose Sharks" loading="lazy">
        <img src="https://media.video-cdn.espn.com/motion/2025/1023/e75096bbf0764d928b4b19a39a57aabf1298/e75096bbf0764d928b4b19a39a57aabf1298.jpg" alt="Sharks Hockey Game" loading="lazy">
      </div>
      <div class="destination-content">
        <p><span class="highlight">Sharks vs Rangers @ SAP Center</span> - Section 127, Row 15, <strong>CLUB SEATS!</strong> üî•<br>
        Jelly Belly Factory Friday morning, then drive to San Jose for 7pm game. Club seats include premium amenities and incredible views of the ice.</p>
      </div>
      <div class="section-gallery" data-section="sanjose">
        <div class="section-gallery-header">
          <h4>Photos</h4>
          <span class="photo-count"></span>
        </div>
        <div class="gallery-grid" id="gallery-sanjose"></div>
      </div>
    </div>

    <!-- Disneyland -->
    <div class="destination" id="disney">
      <div class="destination-header">
        <h3>üè∞ Disneyland Hotel - 1 Bedroom Suite  <span class="badge badge-fire">üî• 7 NIGHTS</span></h3>
        <div class="destination-dates">Saturday, Jan 24 - Saturday, Jan 31 ‚Ä¢ 366 miles from San Jose</div>
      </div>
      <div class="photo-grid">
        <img src="https://cdn1.parksmedia.wdprapps.disney.com/resize/mwImage/1/1600/900/75/dam/wdpro-assets/dlr/things-to-do/sports-and-recreation-centers/disneyland-hotel/pools-at-disneyland-hotel/pools-disneyland-hotel-04.jpg?1743792166313" alt="Disneyland Hotel Pool" loading="lazy">
        <img src="https://playgroundhb.com/cdn/shop/files/Screenshot_2025-08-07_at_11.04.25_PM.png?v=1754633103&width=1600" alt="Arcade Fun" loading="lazy">
      </div>
      <div class="photo-grid">
        <img src="https://www.disneytouristblog.com/wp-content/uploads/2025/05/wondrous-journeys-fireworks-disneyland-70th-anniversary-california-854.jpg" alt="Disney Fireworks" loading="lazy">
        <img src="https://cdn1.parksmedia.wdprapps.disney.com/resize/mwImage/1/1600/900/75/dam/wdpro-assets/parks-and-tickets/attractions/magic-kingdom/big-thunder-mountain-railroad/big-thunder-mountain-railroad-00.jpg?1765208789463" alt="Big Thunder Mountain" loading="lazy">
      </div>
      <div class="destination-content">
        <p><span class="highlight">Schedule:</span><br>
        ‚Ä¢ <strong>Sat 1/24:</strong> Arrive & settle in<br>
        ‚Ä¢ <strong>Sun 1/25:</strong> üè∞ Park Day<br>
        ‚Ä¢ <strong>Mon 1/26:</strong> üèñÔ∏è Cabana Day<br>
        ‚Ä¢ <strong>Tue 1/27:</strong> üè∞ Park Day<br>
        ‚Ä¢ <strong>Wed 1/28:</strong> üè† Steph's<br>
        ‚Ä¢ <strong>Thu 1/29:</strong> üè∞ Park Day<br>
        ‚Ä¢ <strong>Fri 1/30:</strong> üè∞ Park Day<br>
        ‚Ä¢ <strong>Sat 1/31:</strong> ‚Üí Great Wolf Lodge<br><br>
        <span class="highlight">Must-Do:</span> Cars Land, Avengers Campus, World of Color, üéÜ <strong>Paint the Night Parade!</strong></p>
      </div>
      <div class="section-gallery" data-section="disney">
        <div class="section-gallery-header">
          <h4>Photos</h4>
          <span class="photo-count"></span>
        </div>
        <div class="gallery-grid" id="gallery-disney"></div>
      </div>
    </div>

    <!-- Great Wolf Lodge -->
    <div class="destination" id="greatwolf">
      <div class="destination-header">
        <h3>üåä Great Wolf Lodge SoCal </h3>
        <div class="destination-dates">Saturday, Jan 31 - Monday, Feb 2 ‚Ä¢ 2 Nights ‚Ä¢ 3 miles from Disney</div>
      </div>
      <div class="photo-grid">
        <img src="https://www.momrewritten.com/wp-content/uploads/2025/11/Great-wolf-lodge-wave-pool-overview-728x546.jpg.webp" alt="Great Wolf Lodge Wave Pool" loading="lazy">
        <img src="https://www.rci.com/static/Resorts/Assets/RP71E01L.jpg" alt="Great Wolf Lodge Waterpark" loading="lazy">
      </div>
      <div class="photo-grid">
        <img src="https://californiathroughmylens.com/wp-content/uploads/2017/01/medieval-times-13.jpg" alt="Medieval Times" loading="lazy">
        <img src="https://ewscripps.brightspotcdn.com/dims4/default/0cf666b/2147483647/strip/true/crop/3618x2035+0+188/resize/1280x720!/quality/90/?url=http%3A%2F%2Fewscripps-brightspot.s3.amazonaws.com%2F86%2F65%2Fee82cb744b06b5f0e3e4901f20d1%2Fap24110134853676.jpg" alt="Anaheim Ducks Hockey" loading="lazy">
      </div>
      <div class="destination-content">
        <p><span class="highlight">Full waterpark access!</span> 105,000 sq ft indoor waterpark - slides, wave pool, lazy river, MagiQuest!<br>
        <span class="highlight">Saturday night:</span> ‚öîÔ∏è <strong>Medieval Times 7:30pm</strong> - Celebration Upgrade + Glow Sword!<br>
        <span class="highlight">Sunday 2/1:</span> üèí <strong>Anaheim Ducks @ Honda Center 6:30pm</strong> - Section 307, INSANE seats!</p>
      </div>
      <div class="section-gallery" data-section="greatwolf">
        <div class="section-gallery-header">
          <h4>Photos</h4>
          <span class="photo-count"></span>
        </div>
        <div class="gallery-grid" id="gallery-greatwolf"></div>
      </div>
    </div>

    <!-- Sheraton Redding -->
    <div class="destination" id="redding">
      <div class="destination-header">
        <h3>üè® Sheraton Redding - Presidential Suite  <span class="badge badge-fire">üî• PRESIDENTIAL</span></h3>
        <div class="destination-dates">Monday, Feb 2 - Wednesday, Feb 4 ‚Ä¢ 2 Nights ‚Ä¢ 573 miles from Great Wolf</div>
      </div>
      <div class="photo-grid">
        <img src="https://cache.marriott.com/content/dam/marriott-renditions/RDDSI/rddsi-exterior-2636-hor-wide.jpg?output-quality=70&interpolation=progressive-bilinear&downsize=750px:*" alt="Sheraton Redding Exterior" loading="lazy">
        <img src="https://drupal-prod.visitcalifornia.com/sites/default/files/styles/fluid_1920/public/VCW_D_SC_T4-Sundial%20Bridge_i-8p9WWv_R-L.jpg_KG.jpg.webp?itok=ewh2xT0N" alt="Sundial Bridge" loading="lazy">
      </div>
      <div class="photo-grid">
        <img src="https://images.squarespace-cdn.com/content/v1/591d131d17bffc24f111e867/1591037067920-FUSKLSXQBYX7CKC9KIHZ/1T0A0051.jpg" alt="Turtle Bay" loading="lazy">
        <img src="https://krcrtv.com/resources/media2/16x9/3024/986/0x1166/90/85acdc73-4f19-4f05-84ff-e4662f147cb4-Image31.jpg" alt="Shasta Caverns" loading="lazy">
      </div>
      <div class="destination-content">
        <p><span class="highlight">The nicest room in Redding!</span> 1,100 sq ft Presidential Suite with 3 showers, pool view balcony.<br>
        <span class="highlight">Club Lounge:</span> Wine, charcuterie, cookies at happy hour + full breakfast!<br>
        <span class="highlight">Adventures:</span> üåâ Sundial Bridge evening walk, üö§ Shasta Caverns 12pm Tue, üê¢ Turtle Bay 9am Wed<br>
        <span class="highlight">Home:</span> 410 miles back to Sherwood!</p>
      </div>
      <div class="section-gallery" data-section="redding">
        <div class="section-gallery-header">
          <h4>Photos</h4>
          <span class="photo-count"></span>
        </div>
        <div class="gallery-grid" id="gallery-redding"></div>
      </div>
    </div>
  </section>

  <!-- Visual Calendar -->
  <section>
    <h2 class="section-title" id="calendar">üìÖ Our Adventure Calendar</h2>

    <div class="visual-calendar">
      <div class="cal-day sacramento"><div class="cal-icon">ü¶Å</div><div class="cal-date">Jan 22</div><div class="cal-label">Thu</div></div>
      <div class="cal-day hockey"><div class="cal-icon">üç¨</div><div class="cal-date">Jan 23</div><div class="cal-label">Fri</div></div>
      <div class="cal-day disney"><div class="cal-icon">üõ¨</div><div class="cal-date">Jan 24</div><div class="cal-label">Sat</div></div>
      <div class="cal-day disney"><div class="cal-icon">üè∞</div><div class="cal-date">Jan 25</div><div class="cal-label">Sun</div></div>
      <div class="cal-day disney"><div class="cal-icon">üèñÔ∏è</div><div class="cal-date">Jan 26</div><div class="cal-label">Mon</div></div>
      <div class="cal-day disney"><div class="cal-icon">üè∞</div><div class="cal-date">Jan 27</div><div class="cal-label">Tue</div></div>
      <div class="cal-day disney"><div class="cal-icon">üè†</div><div class="cal-date">Jan 28</div><div class="cal-label">Wed</div></div>
      <div class="cal-day disney"><div class="cal-icon">üè∞</div><div class="cal-date">Jan 29</div><div class="cal-label">Thu</div></div>
      <div class="cal-day disney"><div class="cal-icon">üè∞</div><div class="cal-date">Jan 30</div><div class="cal-label">Fri</div></div>
      <div class="cal-day wolf"><div class="cal-icon">‚öîÔ∏è</div><div class="cal-date">Jan 31</div><div class="cal-label">Sat</div></div>
      <div class="cal-day wolf today" id="cal-feb1"><div class="cal-icon">üèí</div><div class="cal-date">Feb 1</div><div class="cal-label">Sun</div></div>
      <div class="cal-day redding"><div class="cal-icon">üåâ</div><div class="cal-date">Feb 2</div><div class="cal-label">Mon</div></div>
      <div class="cal-day redding"><div class="cal-icon">üö§</div><div class="cal-date">Feb 3</div><div class="cal-label">Tue</div></div>
      <div class="cal-day home"><div class="cal-icon">üè†</div><div class="cal-date">Feb 4</div><div class="cal-label">Wed</div></div>
    </div>

    <div class="cal-legend">
      <span class="cal-legend-item"><span class="legend-dot sacramento-dot"></span> Sacramento</span>
      <span class="cal-legend-item"><span class="legend-dot hockey-dot"></span> Hockey</span>
      <span class="cal-legend-item"><span class="legend-dot disney-dot"></span> Disney</span>
      <span class="cal-legend-item"><span class="legend-dot wolf-dot"></span> Great Wolf</span>
      <span class="cal-legend-item"><span class="legend-dot redding-dot"></span> Redding</span>
    </div>
  </section>

  <!-- Trip Highlights -->
  <section>
    <h2 class="section-title" id="highlights">‚ú® Trip Highlights</h2>

    <div class="highlights">
      <div class="highlight-item"><span class="emoji">ü¶Å</span><span class="text">The Lion King - Orchestra Seats!</span></div>
      <div class="highlight-item"><span class="emoji">üç¨</span><span class="text">Jelly Belly Factory Tour</span></div>
      <div class="highlight-item"><span class="emoji">ü¶à</span><span class="text">Sharks vs Rangers - CLUB SEATS!</span></div>
      <div class="highlight-item"><span class="emoji">üè∞</span><span class="text">7 Nights Disneyland Hotel 1BR Suite</span></div>
      <div class="highlight-item"><span class="emoji">üéÜ</span><span class="text">Paint the Night Parade</span></div>
      <div class="highlight-item"><span class="emoji">üèñÔ∏è</span><span class="text">Steph's Place - Huntington Beach</span></div>
      <div class="highlight-item"><span class="emoji">‚öîÔ∏è</span><span class="text">Medieval Times - Celebration + Glow Sword</span></div>
      <div class="highlight-item"><span class="emoji">üåä</span><span class="text">2 Nights Great Wolf Lodge</span></div>
      <div class="highlight-item"><span class="emoji">üèí</span><span class="text">Anaheim Ducks - Section 307!</span></div>
      <div class="highlight-item"><span class="emoji">üåâ</span><span class="text">Sundial Bridge</span></div>
      <div class="highlight-item"><span class="emoji">üö§</span><span class="text">Shasta Caverns (Boat + Cave)</span></div>
      <div class="highlight-item"><span class="emoji">üê¢</span><span class="text">Turtle Bay Exploration Park</span></div>
      <div class="highlight-item"><span class="emoji">üè®</span><span class="text">Sheraton Presidential Suite + Club üî•</span></div>
      <div class="highlight-item"><span class="emoji">‚ö°</span><span class="text">Lightning Lane - Skip the lines!</span></div>
    </div>
  </section>

  <!-- Family Journal -->
  <section>
    <h2 class="section-title" id="journal">üìù Family Journal</h2>
    <p style="color: var(--gray); margin-bottom: 20px;">Write memories, thoughts, and favorite moments throughout the trip!</p>

    <div id="journal-entries" class="journal-entries">
      <!-- Journal entries load here -->
    </div>
  </section>


  <!-- Footer -->
  <div class="footer">
    <div class="love">üíö</div>
    <div class="trip-message" id="footer-message">6 DAYS UNTIL THE ADVENTURE!</div>
    <div class="sub-message">This is going to be AMAZING!</div>
    <div style="color: var(--green-light); margin-top: 15px;">14 days of adventures together üíõ</div>
  </div>

  <!-- Floating Action Buttons -->
  <div class="floating-actions">
    <button class="fab fab-photo" onclick="openModal('upload')" title="Add Photo">üì∑</button>
    <button class="fab fab-journal" onclick="openModal('journal')" title="Write Entry">‚úèÔ∏è</button>
  </div>

  <!-- Upload Modal -->
  <div class="modal" id="modal-upload">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üì∑ Add Memory</h2>
        <button class="modal-close" onclick="closeModal('upload')">&times;</button>
      </div>
      <div class="form-group">
        <label>Who's Uploading?</label>
        <select id="upload-name">
          <option value="">Select family member...</option>
          <option value="Brandon">Brandon</option>
          <option value="Racheal">Racheal</option>
          <option value="Olivia">Olivia</option>
        </select>
      </div>
      <div class="form-group">
        <label>Which Day?</label>
        <select id="upload-day">
          <option value="">Select a day...</option>
          <option value="1">Day 1 - Sacramento / Lion King</option>
          <option value="2">Day 2 - Jelly Belly / Sharks Game</option>
          <option value="3">Day 3 - Arrive at Disney</option>
          <option value="4">Day 4 - Park Day (Sun)</option>
          <option value="5">Day 5 - Cabana Day (Mon)</option>
          <option value="6">Day 6 - Park Day (Tue)</option>
          <option value="7">Day 7 - Steph's (Wed)</option>
          <option value="8">Day 8 - Park Day (Thu)</option>
          <option value="9">Day 9 - Park Day (Fri)</option>
          <option value="10">Day 10 - Great Wolf / Medieval Times (Sat)</option>
          <option value="11">Day 11 - Great Wolf / Ducks Game (Sun)</option>
          <option value="12">Day 12 - Drive to Redding (Mon)</option>
          <option value="13">Day 13 - Shasta Caverns (Tue)</option>
          <option value="14">Day 14 - Turtle Bay / Home (Wed)</option>
        </select>
      </div>
      <button class="btn" id="upload-btn" onclick="openCloudinaryWidget()">üì∑ Choose Photos or Videos</button>
      <p style="color: var(--gray); font-size: 12px; margin-top: 15px; text-align: center;">Select multiple photos - you can add captions to each one after uploading!</p>
    </div>
  </div>

  <!-- Caption Photos Modal (appears after batch upload) -->
  <div class="modal" id="modal-captions">
    <div class="modal-content" style="max-width: 600px; max-height: 90vh;">
      <div class="modal-header">
        <h2>‚úèÔ∏è Add Captions</h2>
        <button class="modal-close" onclick="closeCaptionModal()">&times;</button>
      </div>
      <p style="color: var(--gray); margin-bottom: 20px;">Add a caption to each photo (optional)</p>
      <div id="caption-photos-list" style="max-height: 50vh; overflow-y: auto; margin-bottom: 20px;">
        <!-- Photos will be inserted here -->
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn" onclick="saveCaptions()" style="flex: 1;">üíæ Save Captions</button>
        <button class="btn" onclick="closeCaptionModal()" style="flex: 1; background: linear-gradient(135deg, #666, #888);">Skip</button>
      </div>
    </div>
  </div>

  <!-- Edit Single Photo Modal -->
  <div class="modal" id="modal-edit-photo">
    <div class="modal-content" style="max-width: 450px;">
      <div class="modal-header">
        <h2>‚úèÔ∏è Edit Caption</h2>
        <button class="modal-close" onclick="closeModal('edit-photo')">&times;</button>
      </div>
      <div id="edit-photo-preview" style="margin-bottom: 20px; text-align: center;">
        <img id="edit-photo-img" src="" style="max-width: 100%; max-height: 200px; border-radius: 12px;">
      </div>
      <input type="hidden" id="edit-photo-id">
      <div class="form-group">
        <label>Caption</label>
        <input type="text" id="edit-photo-caption" placeholder="Add a caption...">
      </div>
      <div class="form-group">
        <label>Which Day / Event?</label>
        <select id="edit-photo-day">
          <option value="0">No specific day</option>
          <option value="1">Day 1 - Sacramento / Lion King</option>
          <option value="2">Day 2 - Jelly Belly / Sharks Game</option>
          <option value="3">Day 3 - Arrive at Disney</option>
          <option value="4">Day 4 - Park Day (Sun)</option>
          <option value="5">Day 5 - Cabana Day (Mon)</option>
          <option value="6">Day 6 - Park Day (Tue)</option>
          <option value="7">Day 7 - Steph's (Wed)</option>
          <option value="8">Day 8 - Park Day (Thu)</option>
          <option value="9">Day 9 - Park Day (Fri)</option>
          <option value="10">Day 10 - Great Wolf / Medieval Times (Sat)</option>
          <option value="11">Day 11 - Great Wolf / Ducks Game (Sun)</option>
          <option value="12">Day 12 - Drive to Redding (Mon)</option>
          <option value="13">Day 13 - Shasta Caverns (Tue)</option>
          <option value="14">Day 14 - Turtle Bay / Home (Wed)</option>
        </select>
      </div>
      <button class="btn" onclick="savePhotoEdit()">Save</button>
    </div>
  </div>

  <!-- Journal Modal -->
  <div class="modal" id="modal-journal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚úèÔ∏è Write Entry</h2>
        <button class="modal-close" onclick="closeModal('journal')">&times;</button>
      </div>
      <form id="journal-form">
        <div class="form-group">
          <label>Who's Writing?</label>
          <select id="journal-name">
            <option value="">Select family member...</option>
            <option value="Brandon">Brandon</option>
            <option value="Racheal">Racheal</option>
            <option value="Olivia">Olivia</option>
          </select>
        </div>
        <div class="form-group">
          <label>Which Day?</label>
          <select id="journal-day">
            <option value="">General / No specific day</option>
            <option value="1">Day 1 - Sacramento / Lion King</option>
            <option value="2">Day 2 - Jelly Belly / Sharks Game</option>
            <option value="3">Day 3 - Arrive at Disney</option>
            <option value="4">Day 4 - Park Day (Sun)</option>
            <option value="5">Day 5 - Cabana Day (Mon)</option>
            <option value="6">Day 6 - Park Day (Tue)</option>
            <option value="7">Day 7 - Steph's (Wed)</option>
            <option value="8">Day 8 - Park Day (Thu)</option>
            <option value="9">Day 9 - Park Day (Fri)</option>
            <option value="10">Day 10 - Great Wolf / Medieval Times (Sat)</option>
            <option value="11">Day 11 - Great Wolf / Ducks Game (Sun)</option>
            <option value="12">Day 12 - Drive to Redding (Mon)</option>
            <option value="13">Day 13 - Shasta Caverns (Tue)</option>
            <option value="14">Day 14 - Turtle Bay / Home (Wed)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Your Thoughts</label>
          <textarea id="journal-content" placeholder="What's on your mind? How are you feeling? What was your favorite part?"></textarea>
        </div>
        <button type="submit" class="btn">Post Entry</button>
      </form>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
    <button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">&#8249;</button>
    <img id="lightbox-img" src="">
    <button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">&#8250;</button>
    <div class="lightbox-counter" id="lightbox-counter"></div>
    <div class="lightbox-caption" id="lightbox-caption"></div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // API Configuration - Cloudflare Worker
    const API_URL = 'https://donnelly-api.brandondonnelly33.workers.dev';

    // Day-to-section mapping
    const DAY_SECTION_MAP = {
      '1': 'sacramento',
      '2': 'sanjose',
      '3': 'disney', '4': 'disney', '5': 'disney', '6': 'disney',
      '7': 'disney', '8': 'disney', '9': 'disney',
      '10': 'greatwolf', '11': 'greatwolf',
      '12': 'redding', '13': 'redding', '14': 'redding'
    };

    // All photos array for lightbox navigation
    let allPhotos = [];
    let currentLightboxIndex = 0;

    // Create stars
    function createStars() {
      const container = document.getElementById('stars');
      for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        container.appendChild(star);
      }
    }
    createStars();

    // Tab navigation - highlight active section on scroll
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabNav = document.getElementById('tab-nav');

    function updateActiveTab() {
      const scrollPos = window.scrollY + 100;
      let activeId = '';

      document.querySelectorAll('[id]').forEach(section => {
        if (section.offsetTop <= scrollPos) {
          activeId = section.id;
        }
      });

      tabLinks.forEach(link => {
        link.classList.toggle('active', link.getAttribute('href') === '#' + activeId);
      });
    }

    window.addEventListener('scroll', updateActiveTab);
    tabLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          const offset = tabNav.offsetHeight + 10;
          window.scrollTo({ top: target.offsetTop - offset, behavior: 'smooth' });
        }
      });
    });

    // Countdown
    function updateCountdown() {
      const tripStart = new Date('2026-01-22T06:00:00');
      const tripEnd = new Date('2026-02-04T18:00:00');
      const now = new Date();
      const diff = tripStart - now;

      // During the trip - show exciting current day info!
      if (diff <= 0 && now <= tripEnd) {
        const msIntoTrip = now - tripStart;
        const currentDay = Math.floor(msIntoTrip / (1000 * 60 * 60 * 24)) + 1;

        // Get today's schedule from TRIP_SCHEDULE if available
        const todaySchedule = typeof TRIP_SCHEDULE !== 'undefined'
          ? TRIP_SCHEDULE.find(s => s.day === currentDay)
          : { icon: 'üåü', location: 'California' };

        const icon = todaySchedule?.icon || 'üåü';
        const location = todaySchedule?.location || 'California';

        document.querySelector('.countdown').innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 64px; margin-bottom: 10px;">${icon}</div>
            <div style="font-size: clamp(28px, 7vw, 42px); color: var(--gold); font-weight: 900; margin-bottom: 8px;">DAY ${currentDay} OF 14</div>
            <div style="font-size: clamp(18px, 4vw, 24px); color: var(--green-light);">${location}</div>
            <div style="font-size: 14px; color: var(--gray); margin-top: 12px; text-transform: uppercase; letter-spacing: 2px;">Living the dream! üéâ</div>
          </div>
        `;
        document.getElementById('footer-message').textContent = `DAY ${currentDay} - ${location.toUpperCase()}!`;
        return;
      }

      // After the trip
      if (now > tripEnd) {
        document.querySelector('.countdown').innerHTML = `
          <div style="text-align: center;">
            <div style="font-size: 64px; margin-bottom: 10px;">üíö</div>
            <div style="font-size: clamp(28px, 7vw, 42px); color: var(--gold); font-weight: 900;">TRIP COMPLETE!</div>
            <div style="font-size: clamp(16px, 4vw, 20px); color: var(--green-light); margin-top: 10px;">What an incredible adventure!</div>
          </div>
        `;
        document.getElementById('footer-message').textContent = "WHAT AN AMAZING ADVENTURE!";
        return;
      }

      // Before the trip - countdown
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      document.getElementById('days').textContent = days;
      document.getElementById('hours').textContent = hours;
      document.getElementById('minutes').textContent = minutes;
      document.getElementById('seconds').textContent = seconds;

      document.getElementById('footer-message').textContent = `${days} DAYS UNTIL THE ADVENTURE!`;
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Modal controls
    function openModal(type) {
      document.getElementById(`modal-${type}`).classList.add('active');
    }

    function closeModal(type) {
      document.getElementById(`modal-${type}`).classList.remove('active');
    }

    // Track uploaded photos for batch captioning
    let pendingUploads = [];

    // Cloudinary Upload Widget
    function openCloudinaryWidget() {
      const uploadedBy = document.getElementById('upload-name').value || 'Anonymous';
      const dayNumber = document.getElementById('upload-day').value || '0';

      pendingUploads = [];

      const widget = cloudinary.createUploadWidget({
        cloudName: 'dpazcxxyp',
        uploadPreset: 'donnelly_unsigned',
        sources: ['local', 'camera'],
        multiple: true,
        maxFiles: 20,
        resourceType: 'auto',
        tags: ['california2026'],
        context: {
          uploaded_by: uploadedBy,
          day_number: dayNumber
        },
        styles: {
          palette: {
            window: '#0d2818',
            windowBorder: '#efbf04',
            tabIcon: '#efbf04',
            menuIcons: '#adebb3',
            textDark: '#0d2818',
            textLight: '#e0e0e0',
            link: '#efbf04',
            action: '#efbf04',
            inactiveTabIcon: '#888',
            error: '#ff4444',
            inProgress: '#efbf04',
            complete: '#adebb3',
            sourceBg: '#1a3d2a'
          }
        }
      }, (error, result) => {
        if (!error && result && result.event === 'success') {
          pendingUploads.push({
            public_id: result.info.public_id,
            url: result.info.secure_url,
            uploaded_by: uploadedBy,
            day_number: dayNumber
          });
        }
        if (result && result.event === 'close') {
          closeModal('upload');
          if (pendingUploads.length > 0) {
            showCaptionModal();
          }
        }
      });

      widget.open();
    }

    // Show caption modal after batch upload
    function showCaptionModal() {
      const container = document.getElementById('caption-photos-list');
      container.innerHTML = pendingUploads.map((photo, index) => `
        <div class="caption-item" data-id="${photo.public_id}">
          <img src="${photo.url}" alt="Uploaded photo">
          <div class="caption-input-wrapper">
            <input type="text"
                   id="caption-input-${index}"
                   placeholder="Add a caption for this photo..."
                   data-public-id="${photo.public_id}"
                   data-uploaded-by="${photo.uploaded_by}"
                   data-day-number="${photo.day_number}">
          </div>
        </div>
      `).join('');

      document.getElementById('modal-captions').classList.add('active');
    }

    function closeCaptionModal() {
      document.getElementById('modal-captions').classList.remove('active');
      pendingUploads = [];
      loadPhotos();
    }

    async function saveCaptions() {
      const inputs = document.querySelectorAll('#caption-photos-list input');
      let saved = 0;

      for (const input of inputs) {
        const caption = input.value.trim();
        if (caption) {
          const publicId = input.dataset.publicId;
          const uploadedBy = input.dataset.uploadedBy;
          const dayNumber = input.dataset.dayNumber;

          try {
            await fetch(`${API_URL}/api/photos/${encodeURIComponent(publicId)}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                caption: caption,
                uploaded_by: uploadedBy,
                day_number: dayNumber
              })
            });
            saved++;
          } catch (err) {
            console.error('Failed to save caption:', err);
          }
        }
      }

      showToast(`${saved > 0 ? saved + ' caption' + (saved > 1 ? 's' : '') + ' saved!' : 'Photos uploaded!'}`);
      closeCaptionModal();
    }

    // Edit single photo - caption and day/event
    function openEditPhoto(publicId, url, caption, dayNumber) {
      document.getElementById('edit-photo-id').value = publicId;
      document.getElementById('edit-photo-img').src = url;
      document.getElementById('edit-photo-caption').value = caption || '';
      document.getElementById('edit-photo-day').value = dayNumber || '0';
      document.getElementById('modal-edit-photo').classList.add('active');
      setTimeout(() => document.getElementById('edit-photo-caption').focus(), 100);
    }

    async function savePhotoEdit() {
      const publicId = document.getElementById('edit-photo-id').value;
      const caption = document.getElementById('edit-photo-caption').value.trim();
      const dayNumber = document.getElementById('edit-photo-day').value;

      try {
        const res = await fetch(`${API_URL}/api/photos/${encodeURIComponent(publicId)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ caption: caption, day_number: dayNumber })
        });

        if (res.ok) {
          showToast('Caption updated!');
          closeModal('edit-photo');
          loadPhotos();
        } else {
          showToast('Failed to update');
        }
      } catch (err) {
        showToast('Failed to update');
      }
    }

    async function deletePhoto(publicId) {
      if (!confirm('Delete this photo?')) return;

      try {
        const res = await fetch(`${API_URL}/api/photos/${encodeURIComponent(publicId)}`, {
          method: 'DELETE'
        });

        if (res.ok) {
          showToast('Photo deleted');
          loadPhotos();
        } else {
          showToast('Failed to delete');
        }
      } catch (err) {
        showToast('Failed to delete');
      }
    }

    // Journal form
    document.getElementById('journal-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const content = document.getElementById('journal-content').value.trim();
      if (!content) {
        showToast('Please write something');
        return;
      }

      try {
        const res = await fetch(`${API_URL}/api/journal`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            author: document.getElementById('journal-name').value || 'Anonymous',
            content: content,
            day_number: document.getElementById('journal-day').value || null
          })
        });

        if (res.ok) {
          showToast('Entry posted!');
          closeModal('journal');
          document.getElementById('journal-form').reset();
          loadJournal();
        }
      } catch (err) {
        showToast('Failed to post');
      }
    });

    // Render a photo gallery item with optimized thumbnails
    function renderPhotoItem(photo) {
      const safeCaption = (photo.caption || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
      const photoIndex = allPhotos.findIndex(p => p.public_id === photo.public_id);
      // Use optimized thumbnail for gallery, full URL for lightbox/edit
      const thumbnailUrl = optimizeCloudinaryUrl(photo.url, 300);
      return `
        <div class="gallery-item" data-id="${photo.public_id}">
          <div class="photo-wrapper" onclick="openLightboxAt(${photoIndex})">
            <img src="${thumbnailUrl}" alt="${photo.caption || ''}" loading="lazy">
          </div>
          <div class="photo-info" onclick="event.stopPropagation(); openEditPhoto('${photo.public_id}', '${photo.url}', '${safeCaption}', '${photo.day_number || 0}')" style="cursor: pointer;">
            ${photo.caption ? `<div class="photo-caption">${photo.caption}</div>` : '<div class="photo-caption" style="color: var(--gold); font-style: italic; font-size: 12px;">Tap to add caption</div>'}
            <div class="photo-meta">
              <span class="photo-author">${photo.uploaded_by || 'Anonymous'}</span>
              <div class="photo-actions">
                <button class="edit-btn" onclick="event.stopPropagation(); openEditPhoto('${photo.public_id}', '${photo.url}', '${safeCaption}', '${photo.day_number || 0}')">Edit</button>
                <button class="delete-btn" onclick="event.stopPropagation(); deletePhoto('${photo.public_id}')">Del</button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Helper to optimize Cloudinary URLs (defined here for use before main definition)
    function optimizeCloudinaryUrl(url, width = 400) {
      if (url && url.includes('cloudinary.com') && !url.includes('/upload/w_')) {
        return url.replace('/upload/', `/upload/w_${width},q_auto,f_auto/`);
      }
      return url;
    }

    // Load photos and distribute to sections
    async function loadPhotos() {
      const sections = ['sacramento', 'sanjose', 'disney', 'greatwolf', 'redding'];
      const sectionContainers = {};
      const sectionCounts = {};

      sections.forEach(s => {
        sectionContainers[s] = document.getElementById(`gallery-${s}`);
        sectionCounts[s] = 0;
      });

      try {
        const res = await fetch(`${API_URL}/api/photos`);
        const photos = await res.json();
        allPhotos = photos;

        // Group photos by section
        const grouped = { sacramento: [], sanjose: [], disney: [], greatwolf: [], redding: [], unassigned: [] };

        photos.forEach(photo => {
          const section = DAY_SECTION_MAP[photo.day_number] || 'unassigned';
          if (grouped[section]) {
            grouped[section].push(photo);
          } else {
            grouped.unassigned.push(photo);
          }
        });

        // Render each section
        sections.forEach(section => {
          const container = sectionContainers[section];
          const sectionPhotos = grouped[section];
          const galleryWrapper = container.closest('.section-gallery');
          const countEl = galleryWrapper.querySelector('.photo-count');

          if (sectionPhotos.length === 0) {
            container.innerHTML = `
              <div class="empty-state" style="grid-column: 1/-1;">
                <div class="icon">üì∑</div>
                <p>No photos yet for this stop</p>
              </div>
            `;
            countEl.textContent = '';
          } else {
            container.innerHTML = sectionPhotos.map(p => renderPhotoItem(p)).join('');
            countEl.textContent = `${sectionPhotos.length} photo${sectionPhotos.length !== 1 ? 's' : ''}`;
          }
        });

        // If there are unassigned photos, add them to the first section with a note
        if (grouped.unassigned.length > 0) {
          const generalContainer = sectionContainers.sacramento;
          const existing = generalContainer.innerHTML;
          if (existing.includes('empty-state')) {
            generalContainer.innerHTML = '';
          }
          grouped.unassigned.forEach(p => {
            generalContainer.innerHTML += renderPhotoItem(p);
          });
        }

      } catch (err) {
        sections.forEach(section => {
          sectionContainers[section].innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><div class="icon">üì∑</div><p>Upload photos during the trip!</p></div>';
        });
      }
    }

    // Load journal from Cloudflare KV
    async function loadJournal() {
      const container = document.getElementById('journal-entries');

      try {
        const res = await fetch(`${API_URL}/api/journal`);
        const entries = await res.json();

        if (entries.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="icon">üìù</div>
              <p>No entries yet - write the first family memory!</p>
            </div>
          `;
          return;
        }

        container.innerHTML = entries.map(entry => {
          const date = new Date(entry.created_at).toLocaleDateString('en-US', {
            month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
          });
          return `
            <div class="journal-entry">
              <span class="author">${entry.author}</span>
              <span class="date">${date}</span>
              ${entry.day_number ? `<span class="date">‚Ä¢ Day ${entry.day_number}</span>` : ''}
              <div class="content">${entry.content}</div>
            </div>
          `;
        }).join('');
      } catch (err) {
        container.innerHTML = '<div class="empty-state"><div class="icon">üìù</div><p>Write memories during the trip!</p></div>';
      }
    }

    // Lightbox with navigation
    function openLightboxAt(index) {
      if (index < 0 || index >= allPhotos.length) return;
      currentLightboxIndex = index;
      const photo = allPhotos[index];
      // Use optimized image for lightbox (1200px for viewing, not full resolution)
      document.getElementById('lightbox-img').src = optimizeCloudinaryUrl(photo.url, 1200);
      document.getElementById('lightbox-caption').textContent = photo.caption || '';
      document.getElementById('lightbox-counter').textContent = `${index + 1} / ${allPhotos.length}`;
      document.getElementById('lightbox').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function navigateLightbox(direction) {
      let newIndex = currentLightboxIndex + direction;
      if (newIndex < 0) newIndex = allPhotos.length - 1;
      if (newIndex >= allPhotos.length) newIndex = 0;
      openLightboxAt(newIndex);
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('active');
      document.body.style.overflow = '';
    }

    // Swipe support for lightbox on mobile
    let touchStartX = 0;
    const lightboxEl = document.getElementById('lightbox');
    lightboxEl.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
    lightboxEl.addEventListener('touchend', e => {
      const diff = e.changedTouches[0].screenX - touchStartX;
      if (Math.abs(diff) > 50) {
        navigateLightbox(diff > 0 ? -1 : 1);
      }
    });

    // Keyboard navigation for lightbox
    document.addEventListener('keydown', function(e) {
      if (document.getElementById('lightbox').classList.contains('active')) {
        if (e.key === 'ArrowLeft') navigateLightbox(-1);
        if (e.key === 'ArrowRight') navigateLightbox(1);
        if (e.key === 'Escape') closeLightbox();
      } else if (e.key === 'Escape') {
        closeModal('upload');
        closeModal('journal');
        closeModal('edit-photo');
        closeModal('captions');
      }
    });

    // Toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Save selected family member to localStorage
    const savedName = localStorage.getItem('donnellyName') || '';
    if (savedName) {
      document.getElementById('upload-name').value = savedName;
      document.getElementById('journal-name').value = savedName;
    }

    document.getElementById('upload-name').addEventListener('change', function() {
      localStorage.setItem('donnellyName', this.value);
      document.getElementById('journal-name').value = this.value;
    });

    document.getElementById('journal-name').addEventListener('change', function() {
      localStorage.setItem('donnellyName', this.value);
      document.getElementById('upload-name').value = this.value;
    });

    // Initial load
    loadPhotos();
    loadJournal();

    // ========== NEW FEATURES ==========

    // Trip dates configuration
    const TRIP_START = new Date('2026-01-22T06:00:00');
    const TRIP_END = new Date('2026-02-04T18:00:00');
    const TRIP_DAYS = 14;

    // Trip schedule - where we are each day
    const TRIP_SCHEDULE = [
      { day: 1, date: '2026-01-22', location: 'Sacramento', icon: 'ü¶Å', section: 'sacramento', coords: { lat: 38.5816, lon: -121.4944 } },
      { day: 2, date: '2026-01-23', location: 'San Jose', icon: 'ü¶à', section: 'sanjose', coords: { lat: 37.3382, lon: -121.8863 } },
      { day: 3, date: '2026-01-24', location: 'Disneyland', icon: 'üè∞', section: 'disney', coords: { lat: 33.8121, lon: -117.9190 } },
      { day: 4, date: '2026-01-25', location: 'Disneyland', icon: 'üè∞', section: 'disney', coords: { lat: 33.8121, lon: -117.9190 } },
      { day: 5, date: '2026-01-26', location: 'Disneyland', icon: 'üèñÔ∏è', section: 'disney', coords: { lat: 33.8121, lon: -117.9190 } },
      { day: 6, date: '2026-01-27', location: 'Disneyland', icon: 'üè∞', section: 'disney', coords: { lat: 33.8121, lon: -117.9190 } },
      { day: 7, date: '2026-01-28', location: "Steph's", icon: 'üè†', section: 'disney', coords: { lat: 33.6595, lon: -117.9988 } },
      { day: 8, date: '2026-01-29', location: 'Disneyland', icon: 'üè∞', section: 'disney', coords: { lat: 33.8121, lon: -117.9190 } },
      { day: 9, date: '2026-01-30', location: 'Disneyland', icon: 'üè∞', section: 'disney', coords: { lat: 33.8121, lon: -117.9190 } },
      { day: 10, date: '2026-01-31', location: 'Great Wolf', icon: '‚öîÔ∏è', section: 'greatwolf', coords: { lat: 33.8017, lon: -117.8893 } },
      { day: 11, date: '2026-02-01', location: 'Great Wolf', icon: 'üèí', section: 'greatwolf', coords: { lat: 33.8017, lon: -117.8893 } },
      { day: 12, date: '2026-02-02', location: 'Redding', icon: 'üåâ', section: 'redding', coords: { lat: 40.5865, lon: -122.3917 } },
      { day: 13, date: '2026-02-03', location: 'Redding', icon: 'üö§', section: 'redding', coords: { lat: 40.5865, lon: -122.3917 } },
      { day: 14, date: '2026-02-04', location: 'Home!', icon: 'üè†', section: 'redding', coords: { lat: 45.3565, lon: -122.8420 } }
    ];

    // ========== SERVICE WORKER REGISTRATION ==========
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('Service Worker registered:', reg.scope))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }

    // ========== OFFLINE DETECTION ==========
    function updateOnlineStatus() {
      const banner = document.getElementById('offline-banner');
      if (!navigator.onLine) {
        banner.classList.add('show');
      } else {
        banner.classList.remove('show');
      }
    }

    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    // ========== TRIP PROGRESS ==========
    function updateTripProgress() {
      const now = new Date();
      const progressBar = document.getElementById('trip-progress');
      const dayEl = document.getElementById('current-day');
      const fillEl = document.getElementById('progress-fill');
      const textEl = document.getElementById('progress-text');
      const iconEl = document.getElementById('location-icon');
      const nameEl = document.getElementById('location-name');

      // Before trip
      if (now < TRIP_START) {
        const daysUntil = Math.ceil((TRIP_START - now) / (1000 * 60 * 60 * 24));
        dayEl.textContent = daysUntil;
        document.querySelector('.trip-day-label').textContent = 'Days Until Trip';
        fillEl.style.width = '0%';
        textEl.textContent = 'The adventure begins soon!';
        iconEl.textContent = 'üè†';
        nameEl.textContent = 'Home (Oregon)';
        return;
      }

      // After trip
      if (now > TRIP_END) {
        dayEl.textContent = '‚úì';
        document.querySelector('.trip-day-label').textContent = 'Trip Complete!';
        fillEl.style.width = '100%';
        textEl.textContent = 'What an amazing adventure!';
        iconEl.textContent = 'üè†';
        nameEl.textContent = 'Back Home';
        return;
      }

      // During trip - calculate current day
      const msIntoTrip = now - TRIP_START;
      const currentDay = Math.floor(msIntoTrip / (1000 * 60 * 60 * 24)) + 1;
      const progress = (currentDay / TRIP_DAYS) * 100;

      // Find today's schedule
      const todaySchedule = TRIP_SCHEDULE.find(s => s.day === currentDay) || TRIP_SCHEDULE[0];

      dayEl.textContent = currentDay;
      document.querySelector('.trip-day-label').textContent = 'Day of Trip';
      fillEl.style.width = `${progress}%`;
      textEl.textContent = `Day ${currentDay} of ${TRIP_DAYS}`;
      iconEl.textContent = todaySchedule.icon;
      nameEl.textContent = todaySchedule.location;

      // Highlight current destination section
      highlightCurrentDestination(todaySchedule.section);

      // Load weather for current location
      loadWeather(todaySchedule);
    }

    // ========== HIGHLIGHT CURRENT DESTINATION ==========
    function highlightCurrentDestination(sectionId) {
      // Remove previous highlighting
      document.querySelectorAll('.destination').forEach(d => {
        d.classList.remove('currently-here');
        const badge = d.querySelector('.currently-here-badge');
        if (badge) badge.remove();
      });

      // Add highlighting to current section
      const currentSection = document.getElementById(sectionId);
      if (currentSection) {
        currentSection.classList.add('currently-here');
        const header = currentSection.querySelector('.destination-header h3');
        if (header && !header.querySelector('.currently-here-badge')) {
          const badge = document.createElement('span');
          badge.className = 'currently-here-badge';
          badge.textContent = 'LIVE NOW';
          header.appendChild(badge);
        }
      }
    }

    // ========== WEATHER WIDGET ==========
    async function loadWeather(schedule) {
      const iconEl = document.getElementById('weather-icon');
      const tempEl = document.getElementById('weather-temp');
      const descEl = document.getElementById('weather-desc');
      const locEl = document.getElementById('weather-location');

      try {
        // Using Open-Meteo (free, no API key needed)
        const res = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${schedule.coords.lat}&longitude=${schedule.coords.lon}&current=temperature_2m,weather_code&temperature_unit=fahrenheit&timezone=America/Los_Angeles`
        );
        const data = await res.json();

        const temp = Math.round(data.current.temperature_2m);
        const code = data.current.weather_code;

        // Weather code to emoji and description
        const weatherMap = {
          0: { icon: '‚òÄÔ∏è', desc: 'Clear sky' },
          1: { icon: 'üå§Ô∏è', desc: 'Mainly clear' },
          2: { icon: '‚õÖ', desc: 'Partly cloudy' },
          3: { icon: '‚òÅÔ∏è', desc: 'Overcast' },
          45: { icon: 'üå´Ô∏è', desc: 'Foggy' },
          48: { icon: 'üå´Ô∏è', desc: 'Rime fog' },
          51: { icon: 'üåßÔ∏è', desc: 'Light drizzle' },
          53: { icon: 'üåßÔ∏è', desc: 'Drizzle' },
          55: { icon: 'üåßÔ∏è', desc: 'Heavy drizzle' },
          61: { icon: 'üåßÔ∏è', desc: 'Light rain' },
          63: { icon: 'üåßÔ∏è', desc: 'Rain' },
          65: { icon: 'üåßÔ∏è', desc: 'Heavy rain' },
          80: { icon: 'üå¶Ô∏è', desc: 'Light showers' },
          81: { icon: 'üå¶Ô∏è', desc: 'Showers' },
          82: { icon: '‚õàÔ∏è', desc: 'Heavy showers' },
          95: { icon: '‚õàÔ∏è', desc: 'Thunderstorm' }
        };

        const weather = weatherMap[code] || { icon: 'üå°Ô∏è', desc: 'Weather data' };

        iconEl.textContent = weather.icon;
        tempEl.textContent = `${temp}¬∞F`;
        descEl.textContent = weather.desc;
        locEl.textContent = `üìç ${schedule.location}`;

      } catch (err) {
        console.log('Weather fetch failed:', err);
        iconEl.textContent = 'üå°Ô∏è';
        tempEl.textContent = '--¬∞F';
        descEl.textContent = 'Weather unavailable';
        locEl.textContent = `üìç ${schedule.location}`;
      }
    }

    // ========== SCROLL ENTRANCE ANIMATIONS ==========
    function initScrollAnimations() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

      // Add animation class to destinations and highlights
      document.querySelectorAll('.destination, .highlight-item, .cal-day').forEach(el => {
        el.classList.add('animate-on-scroll');
        observer.observe(el);
      });
    }


    // ========== EMOJI REACTIONS (Prep for future use) ==========
    const REACTION_EMOJIS = ['‚ù§Ô∏è', 'üî•', 'üòÇ', 'ü§©', 'üëè', 'üíØ'];

    function createReactionBar(targetId, targetType = 'photo') {
      const html = `
        <div class="reactions-bar" data-target="${targetId}" data-type="${targetType}">
          ${REACTION_EMOJIS.slice(0, 4).map(emoji =>
            `<button class="reaction-btn" data-emoji="${emoji}">${emoji} <span class="count">0</span></button>`
          ).join('')}
          <button class="add-reaction-btn" onclick="toggleReactionPicker(this)">+</button>
          <div class="reaction-picker">
            ${REACTION_EMOJIS.map(emoji =>
              `<button onclick="addReaction('${targetId}', '${emoji}', '${targetType}')">${emoji}</button>`
            ).join('')}
          </div>
        </div>
      `;
      return html;
    }

    function toggleReactionPicker(btn) {
      const picker = btn.nextElementSibling;
      picker.classList.toggle('show');
    }

    async function addReaction(targetId, emoji, targetType) {
      // Close picker
      document.querySelectorAll('.reaction-picker.show').forEach(p => p.classList.remove('show'));

      // For now, just show a toast - full implementation would save to API
      showToast(`${emoji} reaction added!`);
    }

    // ========== MEMORY COUNTER & PHOTO OF DAY ==========
    async function loadMemoryStats() {
      try {
        const res = await fetch(`${API_URL}/api/photos`);
        const photos = await res.json();

        // Update memory counter
        const countEl = document.getElementById('photo-count');
        const subtitleEl = document.getElementById('memory-subtitle');

        countEl.textContent = photos.length;

        // Count photos by day to show variety
        const days = new Set(photos.map(p => p.day_number).filter(d => d));
        subtitleEl.textContent = `Across ${days.size} amazing days!`;

        // Photo of the Day - pick a great one
        loadPhotoOfDay(photos);

      } catch (err) {
        console.log('Memory stats failed:', err);
        document.getElementById('photo-count').textContent = 'üéâ';
        document.getElementById('memory-subtitle').textContent = 'Making memories!';
      }
    }

    function loadPhotoOfDay(photos) {
      const container = document.getElementById('photo-of-day');

      // Filter photos with captions (the best ones!)
      const captionedPhotos = photos.filter(p => p.caption && p.caption.trim());

      if (captionedPhotos.length === 0) {
        container.style.display = 'none';
        return;
      }

      // Pick a featured photo - randomize from the best captioned ones
      // Prioritize recent photos (higher day numbers)
      const sortedByCaptionQuality = captionedPhotos.sort((a, b) => {
        // Prefer longer captions (more thought put in)
        const aScore = (a.caption?.length || 0) + (parseInt(a.day_number) || 0) * 5;
        const bScore = (b.caption?.length || 0) + (parseInt(b.day_number) || 0) * 5;
        return bScore - aScore;
      });

      // Pick from top 5
      const topPhotos = sortedByCaptionQuality.slice(0, 5);
      const featured = topPhotos[Math.floor(Math.random() * topPhotos.length)];

      // Populate
      document.getElementById('potd-image').src = optimizeCloudinaryUrl(featured.url, 600);
      document.getElementById('potd-caption').textContent = featured.caption;
      document.getElementById('potd-author').textContent = featured.uploaded_by || 'The Family';
      document.getElementById('potd-day').textContent = featured.day_number ? `Day ${featured.day_number}` : '';

      // Show it
      container.classList.add('show');
    }

    // ========== HIGHLIGHT TODAY ON CALENDAR ==========
    function highlightTodayOnCalendar() {
      const now = new Date();
      const month = now.getMonth() + 1; // 1-12
      const day = now.getDate();

      // Map date to calendar element
      const dateMap = {
        '1-22': 'Jan 22', '1-23': 'Jan 23', '1-24': 'Jan 24', '1-25': 'Jan 25',
        '1-26': 'Jan 26', '1-27': 'Jan 27', '1-28': 'Jan 28', '1-29': 'Jan 29',
        '1-30': 'Jan 30', '1-31': 'Jan 31', '2-1': 'Feb 1', '2-2': 'Feb 2',
        '2-3': 'Feb 3', '2-4': 'Feb 4'
      };

      const todayKey = `${month}-${day}`;
      const todayText = dateMap[todayKey];

      if (todayText) {
        // Find and highlight today's calendar day
        document.querySelectorAll('.cal-day').forEach(el => {
          el.classList.remove('today');
          const dateEl = el.querySelector('.cal-date');
          if (dateEl && dateEl.textContent === todayText) {
            el.classList.add('today');
          }
        });
      }
    }

    // ========== INITIALIZE ALL NEW FEATURES ==========
    function initNewFeatures() {
      updateTripProgress();
      initScrollAnimations();
      loadMemoryStats();
      highlightTodayOnCalendar();

      // Update progress every minute
      setInterval(updateTripProgress, 60000);
    }

    // Run after DOM is ready
    initNewFeatures();
  </script>

</body>
</html>
